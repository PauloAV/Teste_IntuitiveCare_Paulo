# üè• Teste T√©cnico - Engenharia de Dados (ANS)

Este projeto realiza o pipeline de dados (ETL) para extra√ß√£o, transforma√ß√£o e carregamento de Demonstra√ß√µes Cont√°beis das operadoras de planos de sa√∫de, provenientes dos Dados Abertos da ANS.

## üöÄ Funcionalidades

### 1. Extra√ß√£o Autom√°tica (`src/etl/extraction.py`)
- **Automa√ß√£o de Datas:** O script calcula automaticamente a data atual e busca os √∫ltimos 3 trimestres dispon√≠veis, sem necessidade de alterar o c√≥digo manualmente.
- **Margem de Seguran√ßa:** Implementada l√≥gica de "lag" (atraso) de 120 dias para respeitar o calend√°rio de publica√ß√£o da ANS e evitar erros 404.
- **Resili√™ncia:** Tratamento de erros de conex√£o e verifica√ß√£o de integridade dos arquivos ZIP baixados.
- **Organiza√ß√£o:** Os arquivos brutos s√£o salvos automaticamente em `data/raw`.

## üõ†Ô∏è Decis√µes T√©cnicas (Trade-offs)

### 1. Estrat√©gia de Processamento
Optei pelo processamento **em mem√≥ria (In-Memory)** utilizando Pandas.
**Justificativa:** O volume total dos arquivos trimestrais (aprox. 150MB) cabe confortavelmente na RAM (8GB+). O processamento em stream (chunks) adicionaria complexidade desnecess√°ria para este volume, sendo reservado para escalas de Gigabytes.

### 2. Valida√ß√£o de Dados (Item 2.1)
**Desafio:** Como tratar registros financeiros com CNPJs matematicamente inv√°lidos?
- **Estrat√©gia Escolhida:** *Flagging & Keeping* (Sinalizar e Manter).
- **Implementa√ß√£o:** Foi criada uma flag `CNPJ_Valido` usando valida√ß√£o de M√≥dulo 11.
- **Justificativa:** Em auditorias cont√°beis, a integridade da soma financeira √© priorit√°ria. Um erro de digita√ß√£o no cadastro do CNPJ n√£o anula a exist√™ncia da despesa monet√°ria.
- **Op√ß√£o descartada:** Excluir os registros inv√°lidos causaria diverg√™ncia no balan√ßo total das despesas.

### 3. Enriquecimento e Tratamento de Falhas (Item 2.2)
**Desafio A: Join e Chaves Prim√°rias**
- **Estrat√©gia:** `Left Join` utilizando o CNPJ padronizado (apenas n√∫meros, 14 d√≠gitos).
- **Justificativa:** O `Left Join` (Financeiro -> Cadastral) garante que nenhuma despesa financeira seja perdida, mesmo que a operadora n√£o seja encontrada na base cadastral (ex: operadoras extintas ou diverg√™ncias).
- **Registros sem Match:** Campos como `UF`, `Modalidade` e `RegistroANS` foram preenchidos com "N/D" para manter a estrutura tabular.

**Desafio B: Duplicidade no Cadastro (Cadop)**
- **Problema:** O arquivo do Cadop pode conter m√∫ltiplos registros hist√≥ricos para o mesmo CNPJ.
- **Estrat√©gia:** Deduplica√ß√£o pr√©via utilizando `drop_duplicates(subset=['CNPJ'], keep='last')`.
- **Justificativa:** Realizar um join com uma base duplicada geraria um **Produto Cartesiano**, multiplicando erroneamente os valores das despesas. Manter o cadastro mais recente garante a unicidade.

### 4. Agrega√ß√£o e Ordena√ß√£o (Item 2.3)
**Desafio: Performance vs. Legibilidade**
- **Estrat√©gia:** Ordena√ß√£o descendente (`DESC`) pela coluna `Total_Despesas`.
- **Justificativa:** Baseado no Princ√≠pio de Pareto (80/20). Ordenar pelo total permite identificar imediatamente os *big players* e *outliers* do mercado.

## üìä Arquivos Gerados (`data/processed/`)

1.  **`consolidado.csv`**: Arquivo base contendo todas as despesas trimestrais, enriquecido com dados cadastrais (RegistroANS, Modalidade, UF).
2.  **`demonstracoes_contabeis_consolidadas.zip`**: Vers√£o compactada do consolidado (Entrega do Item 1).
3.  **`despesas_agregadas.csv`**: Relat√≥rio anal√≠tico final com totais, m√©dia trimestral e desvio padr√£o por operadora (Entrega do Item 2).

---

## üì¶ Como Executar

Certifique-se de ter o **Python 3.11.9** instalado (vers√£o utilizada no desenvolvimento).

1. **Crie um ambiente virtual (opcional, mas recomendado):**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux/Mac
   .venv\Scripts\activate     # Windows
   
2. **Instale as depend√™ncias:**
   ```bash
   pip install -r requirements.txt